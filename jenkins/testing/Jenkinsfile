@Library('saao-shared-library') _

pipeline {
  agent any

  stages {
    stage('Run tests') {
      agent {
        dockerfile {
          filename 'Dockerfile'
          dir 'jenkins'
          args '-v imephu-venv:/.cache/pypoetry -u 0:0'
        }
      }

      steps {
        script {
          saao.runPythonTests(
            'black': ['src', 'tests'],
            'mypy': ['src', 'tests'],
            'pytest': ['tests'],
            'ruff': ['src', 'tests'],
            'usePoetry': true
          )
        }
      }
    }
  }

  post {
    always {
      script {
        saao.generatePythonTestReports()
      }
    }
  }
}
